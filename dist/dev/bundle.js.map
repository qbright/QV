{"version":3,"file":"bundle.js.map","sources":["../Users/zhengqiguang/Work/github/QV/src/common/selector.js","../Users/zhengqiguang/Work/github/QV/src/core/compiler.js","../Users/zhengqiguang/Work/github/QV/src/core/render.js","../Users/zhengqiguang/Work/github/QV/src/core/event-loop.js","../Users/zhengqiguang/Work/github/QV/src/core/node.js","../Users/zhengqiguang/Work/github/QV/src/core/watcher.js","../Users/zhengqiguang/Work/github/QV/src/core/data.js","../Users/zhengqiguang/Work/github/QV/src/core/core.js","../Users/zhengqiguang/Work/github/QV/src/index.js"],"sourcesContent":["/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nexport default {\n    s(selector = \"\"){ //单个\n        return document.querySelector(selector);\n    },\n    m(selector = \"\"){// 集合\n        return document.querySelectorAll(selector);\n    },\n    id(id = \"\"){\n        return document.getElementById(id);\n    }\n\n}\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nconst compiler_helper = {\n    generaltplFn(tpl){\n\n        let patt = /{{[ \\t]*([\\w\\W]*?)[ \\t]*}}/g,\n            result;\n\n        let tempStrFn = \"\",\n            fnArgs = [],\n            cursor = 0;\n\n\n        while ((result = patt.exec(tpl)) !== null) {\n\n            console.log(result);\n\n            var $temp1 = tpl.slice(cursor, result.index);\n            cursor += $temp1.length;\n\n            tempStrFn += this.wrapStaticBlock($temp1);\n\n            // let $temp2 = tpl.slice(cursor, cursor + result[0].length);\n\n            fnArgs.push(result[1]);\n            tempStrFn += this.wrapDynamicBlock(result);\n            cursor += result[0].length;\n        }\n\n        let tempLast = tpl.slice(cursor, tpl.length);\n\n\n        tempStrFn += this.wrapStaticBlock(tempLast);\n\n        let tplFn = this.gTplFn(tempStrFn);\n\n        return {\n            tplFn: tplFn,\n            linkArgs: fnArgs\n        }\n    },\n    wrapStaticBlock: function (str) {\n\n        return \"\\'\" + str + \"\\'\";\n\n    },\n    wrapDynamicBlock: function (result) {\n\n        return \" + od.\" + result[1] + \" + \"\n    },\n    gTplFn: function (str) {\n\n        let $t = \"return \" + str;\n\n        $t = $t.replace(/\\n/g, \"\");\n\n        let $tempFn = new Function(\"od\", $t);\n\n        return $tempFn;\n\n    }\n\n\n}\n\n\nclass Compiler {\n\n\n    constructor(tpl) {\n        this.tpl = tpl;\n        this.init(compiler_helper.generaltplFn(this.tpl));\n    }\n\n    init({tplFn, linkArgs}) {\n        this.tplFn = tplFn;\n        this.linkArgs = linkArgs;\n    }\n\n}\n\n\nexport default Compiler;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\n\n\nconst render = {\n\n    mount($node, $data){\n\n        let $newDom = this.generalDom($node.$tplfn($data));\n\n        this.replaceNode($newDom, $node);\n\n    },\n\n    generalDom(domStr){\n        var $temp = document.createElement(\"div\");\n        $temp.innerHTML = domStr.trim(); //不然会有多余的空格等东西\n        return $temp.childNodes[0];\n    },\n\n    replaceNode(newDom, node){\n        let $el = node.$el;\n\n        $el.parentNode.replaceChild(newDom, $el);\n\n        node.$el = newDom;\n    }\n\n\n}\n\n\nexport default render;","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\n\nlet EventLoop = {\n    d_o(fn){\n        let p = Promise.resolve();\n        p.then(fn).catch((e) => {\n            console.log(e);\n        });\n    }\n\n}\n\nexport default EventLoop;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nimport selector from  \"../common/selector\";\n\nimport Compiler from \"./compiler\";\n\nimport Render  from \"./render\";\n\nimport EventLoop from \"./event-loop\";\n\nclass Node {\n\n    constructor({el, template, data}) {\n        this.$data = data;\n        this.el = el;\n        this.template = template;\n        this.$el = selector.s(this.el);\n\n        let $t = selector.s(this.template);\n        if ($t) {\n            this.$template = $t.innerHTML.trim();\n        } else {\n            //error\n        }\n        this.$compiler = new Compiler(this.$template);\n\n        this.$args = this.$compiler.linkArgs;\n        this.$tplfn = this.$compiler.tplFn;\n    }\n\n    update() {\n        EventLoop.d_o(Render.mount.bind(Render, this, this.$data));\n    }\n\n}\n\nexport default Node;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nclass Watcher {\n    constructor(data) {\n        this.$data = data;\n        this.mountWatcher();\n\n    }\n\n    mountWatcher() {\n\n        let od = this.$data[\"_od_\"];\n\n        for (let key in this.$data) {\n\n            (function (key) {\n\n                let timeoutHandler = null;\n\n                if (key !== \"_od_\" && !od[key].mounted) {\n                    if (!od[key]) {\n                        throw new Error(`data:${key} is init `);\n                    }\n                    Object.defineProperty(this.$data, key, {\n                        get () {\n                            return od[key].value;\n                        },\n                        set(value) {\n                            clearTimeout(timeoutHandler);\n                            setTimeout(() => {\n                                if (value !== od[key].value) {\n                                    var $n = od[key].linkNodes;\n                                    od[key].value = value;\n                                    for (var i = 0, n; n = $n[i]; i++) {\n                                        n.update();\n                                    }\n                                }\n                            }, 1000 / 60);//一帧节流\n\n                        }\n                    });\n                    od[key].mounted = true;\n                }\n            }.bind(this))(key);\n\n        }\n    }\n\n    linkNode($node) {\n\n        for (let i = 0, n; n = $node.$args[i]; i++) {\n            if (this.$data[n] &&\n                this.$data[\"_od_\"][n] &&\n                this.$data[\"_od_\"][n].linkNodes.indexOf($node) === -1) {\n                this.$data[\"_od_\"][n].linkNodes.push($node);\n            }\n        }\n    }\n\n\n    updateData() {\n\n\n    }\n\n\n}\n\n\nexport default Watcher;\n","/**\n * Created by zhengqiguang on 2017/6/15.\n */\n\nconst helper = {\n    insertOD($targetData, $data){\n\n        !$targetData && ($targetData = {});\n\n        for (var key in $data) {\n            $targetData[key] = {\n                value: $data[key],\n                linkNodes: [],\n                mounted: false\n            }\n        }\n        return $targetData;\n    }\n}\n\nclass Data {\n    static formatData(data = {}) {\n        data[\"_od_\"] = helper.insertOD(data[\"_od_\"], data);\n        return data;\n    }\n}\n\nexport default Data;\n","/**\n * Created by zhengqiguang on 2017/6/14.\n */\n\nimport Node from \"./node\";\nimport Watcher from \"./watcher\";\nimport Data from \"./data\";\nimport render from \"./render\";\n\nclass QV {\n    constructor(opt = {}) {\n        this._$opt = opt;\n\n        this.formatOption(opt);\n\n        this.mountRoot();\n\n    }\n\n    formatOption(opt) {\n\n        this.$data = Data.formatData(opt.data);\n\n        this.$root = new Node(opt);\n\n        this.$watcher = new Watcher(this.$data);\n\n        this.$watcher.linkNode(this.$root);\n\n    }\n\n    mountRoot() {\n        render.mount(this.$root, this.$data);\n    }\n\n\n}\n\n\nexport  default QV;\n","/**\n * Created by zhengqiguang on 2017/6/14.\n */\n\n\nimport Core from \"./core/core\";\n\n\n\nexport default Core;\n"],"names":["selector","document","querySelector","querySelectorAll","id","getElementById","compiler_helper","tpl","patt","result","tempStrFn","fnArgs","cursor","exec","log","$temp1","slice","index","length","wrapStaticBlock","push","wrapDynamicBlock","tempLast","tplFn","gTplFn","str","$t","replace","$tempFn","Function","Compiler","init","generaltplFn","linkArgs","render","$node","$data","$newDom","generalDom","$tplfn","replaceNode","domStr","$temp","createElement","innerHTML","trim","childNodes","newDom","node","$el","parentNode","replaceChild","EventLoop","fn","p","Promise","resolve","then","catch","e","Node","el","template","data","s","$template","$compiler","$args","d_o","Render","mount","bind","Watcher","mountWatcher","od","key","timeoutHandler","mounted","Error","defineProperty","value","$n","linkNodes","i","n","update","indexOf","helper","$targetData","Data","insertOD","QV","opt","_$opt","formatOption","mountRoot","formatData","$root","$watcher","linkNode"],"mappings":"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"}